<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>DynaMix: Basic Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynaMix
   &#160;<span id="projectnumber">1.3.7</span>
   </div>
   <div id="projectbrief">A new take on polymorphism in C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('basic.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Basic Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>(For the complete, working source of this example see <a href="https://github.com/iboB/dynamix/blob/master/tutorial/basic.cpp">basic.cpp</a>)</p>
<p>Let's imagine a program that needs to create representations for various music players. So let's first write the media reader interfaces.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>cd_reader</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">string</span> get_sound();</div><div class="line">    <span class="keywordtype">void</span> insert_cd(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cd);</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keywordtype">string</span> _cd;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>mp3_reader</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">string</span> get_sound();</div><div class="line">    <span class="keywordtype">void</span> copy_mp3(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; mp3);</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keywordtype">string</span> _mp3;</div><div class="line">};</div></div><!-- fragment --><p> As you can see with respect to the type of media which is played, we could have those two classes that share the interface <code>get_sound</code> and have some unique methods to provide the media.</p>
<p>An approach, alternative to DynaMix here could have been to have a common parent with a pure virtual method <code>get_sound</code>.</p>
<p>Now let's add the macros that will make our classes work as mixins and the macro that will define the message, that they will implement.</p>
<div class="fragment"><div class="line">DYNAMIX_MESSAGE_0(<span class="keywordtype">string</span>, get_sound);</div><div class="line"><a class="code" href="message__macros_8hpp.html#a4ea78051262bb047d5127da21a2e7af0">DYNAMIX_DEFINE_MESSAGE</a>(get_sound);</div><div class="line"></div><div class="line"><a class="code" href="mixin_8hpp.html#acebfdad3adf70d4da7e221d7fdf8fb6d" title="Declares a class as a mixin. ">DYNAMIX_DECLARE_MIXIN</a>(cd_reader);</div><div class="line"><a class="code" href="mixin_8hpp.html#ae96d7f5e4580604c41e932d1937b1c14" title="defines a mixin ">DYNAMIX_DEFINE_MIXIN</a>(cd_reader, get_sound_msg);</div><div class="line"></div><div class="line"><a class="code" href="mixin_8hpp.html#acebfdad3adf70d4da7e221d7fdf8fb6d" title="Declares a class as a mixin. ">DYNAMIX_DECLARE_MIXIN</a>(mp3_reader);</div><div class="line"><a class="code" href="mixin_8hpp.html#ae96d7f5e4580604c41e932d1937b1c14" title="defines a mixin ">DYNAMIX_DEFINE_MIXIN</a>(mp3_reader, get_sound_msg);</div></div><!-- fragment --><p> First, notice how we tell the library that the mixin implements the interface (or message) <code>get_sound</code>. We need to add the suffix <code>_msg</code> when we refer to the message like this.</p>
<p>Second, although we declare and define the messages and mixins on consecutive lines here, this is not a requirement. Normally you'd want to have the declarations in header files and the definitions in cpp files. See the more detailed Examples section for an example about that.</p>
<p>Now let's define a new axis for our classes: the type of output they'll have:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>headphones_output</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">void</span> play();</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>speakers_output</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">void</span> play();</div><div class="line">};</div></div><!-- fragment --><p> and then, again "tell" the library about the new message and mixins:</p>
<div class="fragment"><div class="line">DYNAMIX_MESSAGE_0(<span class="keywordtype">void</span>, play);</div><div class="line"><a class="code" href="message__macros_8hpp.html#a4ea78051262bb047d5127da21a2e7af0">DYNAMIX_DEFINE_MESSAGE</a>(play);</div><div class="line"></div><div class="line"><a class="code" href="mixin_8hpp.html#acebfdad3adf70d4da7e221d7fdf8fb6d" title="Declares a class as a mixin. ">DYNAMIX_DECLARE_MIXIN</a>(headphones_output);</div><div class="line"><a class="code" href="mixin_8hpp.html#ae96d7f5e4580604c41e932d1937b1c14" title="defines a mixin ">DYNAMIX_DEFINE_MIXIN</a>(headphones_output, play_msg);</div><div class="line"></div><div class="line"><a class="code" href="mixin_8hpp.html#acebfdad3adf70d4da7e221d7fdf8fb6d" title="Declares a class as a mixin. ">DYNAMIX_DECLARE_MIXIN</a>(speakers_output);</div><div class="line"><a class="code" href="mixin_8hpp.html#ae96d7f5e4580604c41e932d1937b1c14" title="defines a mixin ">DYNAMIX_DEFINE_MIXIN</a>(speakers_output, play_msg);</div></div><!-- fragment --><p> Now we're ready to create a simple object composed from our newly defined mixins:</p>
<div class="fragment"><div class="line"><a class="code" href="classdynamix_1_1object.html" title="The main object class. ">dynamix::object</a> sound_player; <span class="comment">// just an empty dynamix::object</span></div><div class="line"></div><div class="line"><a class="code" href="classdynamix_1_1single__object__mutator.html">dynamix::mutate</a>(sound_player)</div><div class="line">    .add&lt;cd_reader&gt;()</div><div class="line">    .add&lt;headphones_output&gt;();</div></div><!-- fragment --><p> Now we have an object, which has internally instantiated the mixin classes. So let's start using it.</p>
<p>Since there is no polymorphic way of setting the music, we'll have to explicitly get the appropriate mixin and set it like this:</p>
<div class="fragment"><div class="line">sound_player.<a class="code" href="classdynamix_1_1object.html#a3ac87d5fed5273a72e40cff82fe0a2c5">get</a>&lt;cd_reader&gt;()-&gt;insert_cd(<span class="stringliteral">&quot;Led Zeppelin IV (1971)&quot;</span>);</div></div><!-- fragment --><p> However playing music <em>is</em> a polymorphic operation and via the message <code>play</code> it can be done in this simple manner:</p>
<div class="fragment"><div class="line">play(sound_player);</div></div><!-- fragment --><p> This is the way to call DynaMix messages. They are nothing more than global functions defined by the <code>DYNAMIX_MESSAGE</code> macros. Internally they will find the appropriate class instance and call the appropriate message (or trigger a run-time error if this cannot be done).</p>
<p>Something else that we can do with our object is make a live mutation of its type via the <code>mutate</code> class. And change the playing behavior.</p>
<div class="fragment"><div class="line"><a class="code" href="classdynamix_1_1single__object__mutator.html">dynamix::mutate</a>(sound_player)</div><div class="line">    .remove&lt;headphones_output&gt;()</div><div class="line">    .add&lt;speakers_output&gt;();</div><div class="line"></div><div class="line">play(sound_player);</div></div><!-- fragment --><p> The music is now being played through speakers instead of headphones.</p>
<p>Naturally we could also mutate the object by changing the media provider part:</p>
<div class="fragment"><div class="line"><a class="code" href="classdynamix_1_1single__object__mutator.html">dynamix::mutate</a>(sound_player)</div><div class="line">    .remove&lt;cd_reader&gt;()</div><div class="line">    .add&lt;mp3_reader&gt;();</div><div class="line"></div><div class="line">sound_player.<a class="code" href="classdynamix_1_1object.html#a3ac87d5fed5273a72e40cff82fe0a2c5">get</a>&lt;mp3_reader&gt;()-&gt;copy_mp3(<span class="stringliteral">&quot;Led Zeppelin - Black Dog.mp3&quot;</span>);</div><div class="line"></div><div class="line">play(sound_player);</div></div><!-- fragment --><p> And have "Black Dog" played through the existing mixin <code>speakers_output</code>.</p>
<p>Compared to a classic approach to a similar problem &ndash; multiple inheritance &ndash; this saves us a lot of classes; in this case four for all the combinations of types of media and types of speakers, which might not sound like much, but keep in mind that the library is appropriate for big systems, that may have hundreds or even thousands of possible combinations.</p>
<p>The last thing we'll cover in this basic example is how the speakers-specific players "know" what sound to play. Remember the message we defined earlier, that was supposed to be used to retrieve the sound from the media-specific players &ndash; <code>get_sound</code>. It wasn't used before, but it is used by the speakers to obtain the sound polymorphically.</p>
<p>All mixins may use a special macro that refers to their owning object &ndash; <code>dm_this</code>. Thus the following (pseudo) methods are possible:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> headphones_output::play()</div><div class="line">{</div><div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;playing &quot;</span> &lt;&lt; get_sound(<a class="code" href="mixin_8hpp.html#a8396cc680f14240e8e91a5bfdce4917d" title="a pointer to the owning object of the current mixin ">dm_this</a>)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot; through headphones&quot;</span> &lt;&lt; endl;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> speakers_output::play()</div><div class="line">{</div><div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;PLAYING &quot;</span> &lt;&lt; get_sound(<a class="code" href="mixin_8hpp.html#a8396cc680f14240e8e91a5bfdce4917d" title="a pointer to the owning object of the current mixin ">dm_this</a>)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot; THROUGH SPEAKERS&quot;</span> &lt;&lt; endl;</div><div class="line">}</div></div><!-- fragment --><p> And this covers the most basic usage of DynaMix. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Nov 11 2018 10:50:39 for DynaMix by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
